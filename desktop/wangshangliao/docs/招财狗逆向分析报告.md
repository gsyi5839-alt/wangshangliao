# 招财狗框架 (zc25.12.11) 逆向分析报告

## 1. 系统架构概览

```
┌─────────────────────────────────────────────────────────────────────┐
│                        招财狗框架 (zc25.12.11)                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────────────┐  │
│  │  xplugin.exe │───▶│   zcg.dll    │───▶│  zc25.12.11.exe     │  │
│  │  (千寻框架)   │    │   (插件)      │    │   (主界面 UI)        │  │
│  └──────────────┘    └──────────────┘    └──────────────────────┘  │
│         │                   │                      │               │
│         ▼                   ▼                      ▼               │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────────────┐  │
│  │   HPSocket   │◀──▶│    SQLite    │    │     YX_Client       │  │
│  │  (通信协议)   │    │   (数据库)    │    │   (旺商聊客户端)     │  │
│  │  端口:14745  │    └──────────────┘    └──────────────────────┘  │
│  └──────────────┘                                                   │
│         │                                                           │
│         ▼                                                           │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                   api1.gsdatas.com                            │  │
│  │                   (远程 API 服务器)                            │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## 2. 核心组件分析

### 2.1 启动器 (xplugin.exe)

**路径**: `C:\zcg25.12.11\xplugin.exe`

**功能**:
- 千寻框架核心启动器
- 需要授权密钥启动
- 管理插件加载

**启动方式** (run.cmd):
```batch
xplugin.exe AQAAAAAAAABVZpRGB3OJe9Dyoq00-TJOa2pd5S6a67DOgJ99jytqiIhObUjAyyD77MjQh7N_S-I8aUuWn3Q8Ay-rJmQainc91KXKn4ZOdyXYysCqCnsn7cy4kDddZI4lFB15zsLJmAw...
```

### 2.2 插件系统 (Plugin.ini)

```ini
[Plugin]
46af1699a49d3b343ddf5c1f054e2eea=0
b8b077676bd7fd2972beaf9c1aa32b8e=1|zcg.dll
```

- 插件通过 MD5 哈希标识
- `zcg.dll` 是主要功能插件
- 值格式: `启用状态|插件文件名`

### 2.3 HPSocket 通信

**配置** (zcg端口.ini):
```ini
[端口]
端口=14745
```

**特性**:
- 使用 HPSocket4C.dll 和 HPSocket4C_2.dll
- PACK 模式处理粘包/分包
- 本地通信端口: 14745

### 2.4 数据库结构

| 数据库文件 | 用途 |
|-----------|------|
| 设置.db | 系统设置 |
| 账单.db | 账单数据 |
| 玩家姓名.db | 玩家信息 |
| 攻击.db | 攻击记录 |
| 上下分.db | 上下分记录 |
| 邀请记录.db | 邀请记录 |
| 数据库/日期.db | 按日期的操作数据 |

## 3. 旺商聊客户端 (YX_Client)

### 3.1 目录结构
```
YX_Client/
├── 621705120/           # 账号目录 (以账号命名)
│   ├── 621705120.exe    # 客户端可执行文件
│   ├── YX_Client.dll    # 核心库
│   ├── nim.dll          # 网易云信 SDK
│   ├── HPSocket4C.dll   # 通信库
│   └── log/             # 日志目录
├── log/                 # 公共日志
│   ├── *_qun.txt        # 群消息日志
│   ├── *heart.txt       # 心跳日志
│   └── journal.db       # 日志数据库
└── YX_Client.dll        # 共享库
```

### 3.2 账号配置 (config.ini)
```ini
[1628907626]
账号=621705120
jwtToken=DMKxshoPePzQK08URwtAR6BP3c5w...
qun=iQEpb67flWe6pIT36InkpA==
nickName=某某某
登录状态=1
自动登录=0
```

## 4. 主界面功能 (zc25.12.11.exe)

### 4.1 运行日志
- ID、时间、旺旺ID、类型、消息
- 记录所有操作: 投递成功/失败、群消息发送、好友消息发送

### 4.2 账号列表
- 管理旺商聊账号
- 显示: 昵称、wwid、群号、状态、自动模式

### 4.3 系统设置
- 各种下注规则配置
- 自动回复设置
- 上下分设置
- 回水设置

### 4.4 操作界面
- 客户管理、账单设置、封盘设置、回水工具
- 开奖信息展示 (期数、倒计时、开奖结果)
- 下注操作 (发送单单、导入账单、导入下注)
- 玩家管理
- 上下分管理

## 5. 配置文件加密

### 5.1 加密方式
设置.ini 等配置文件使用 XOR 加密:
- XOR Key: `0x10`
- 编码: GB2312/GBK

### 5.2 值加密示例
```
原文: "1" -> 加密后: "2020CB5D79B"
原文: "0" -> 加密后: "ACC920CB5D79B" (布尔值)
```

## 6. API 通信

### 6.1 远程服务器
- 主服务器: `api1.gsdatas.com`
- 用于获取开奖数据、版本更新等

### 6.2 日志格式
```
2026/1/11 12:49:49    
RQQ:621705120
群:3962369093
fromQQ:781361487
消息类型:插件
内容:发送群消息|Group_SendMsg
```

## 7. 功能模块

### 7.1 下注解析
- 支持多种下注格式 (大小单双、龙虎、顺子等)
- 模糊匹配艾特下注
- 私聊下注支持

### 7.2 自动回复
- 撤回通知、支付宝收款、微信收款
- 历史查询、余额查询
- 关键字自动回复

### 7.3 上下分管理
- 自动上分/下分
- 限额设置
- 回水计算

### 7.4 封盘设置
- 时间封盘
- 手动封盘
- 自动开盘

## 8. 与 WSLFramework 对接建议

### 8.1 协议兼容
```csharp
// HPSocket PACK 模式配置
PackHeaderFlag = 0xFF;
MaxPackSize = 0x100000; // 1MB
Port = 14745;
```

### 8.2 消息格式
参考日志格式设计消息结构:
- RQQ (机器人QQ/账号)
- 群号
- fromQQ (发送者)
- beingQQ (被操作者)
- 消息类型
- 内容

### 8.3 需要实现的接口
1. 群消息发送 (Group_SendMsg)
2. 私聊消息发送 (Friend_Send)
3. 获取群成员列表
4. 获取群信息
5. 心跳保持

## 9. 文件清单

```
C:\zcg25.12.11\
├── xplugin.exe          # 千寻框架启动器
├── xplugin.dll          # 千寻框架核心
├── zc25.12.11.exe       # 招财狗主程序
├── zcg.exe              # 辅助程序
├── Module.dll           # 功能模块
├── HPSocket4C.dll       # HPSocket 通信库
├── HPSocket4C_2.dll     # HPSocket 通信库 (备用)
├── sqlite3.dll          # SQLite 数据库
├── config.ini           # 主配置
├── Plugin.ini           # 插件配置
├── zcg端口.ini          # 端口配置
├── run.cmd              # 启动脚本
├── plugin/              # 插件目录
├── YX_Client/           # 旺商聊客户端
├── zcg/                 # 数据目录
│   ├── *.db            # 数据库文件
│   ├── *.ini           # 配置文件
│   ├── bin/            # 二进制文件
│   ├── 图片/           # 图片资源
│   └── 备份/           # 数据备份
├── zcg收发日志/         # 客户端日志
└── zcg服务端收发日志/   # 服务端日志
```

---
*分析时间: 2026-01-11*
*版本: zc25.12.11*
