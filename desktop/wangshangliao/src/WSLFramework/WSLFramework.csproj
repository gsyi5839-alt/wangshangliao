<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProjectGuid>{C1D2E3F4-A5B6-7890-CDEF-123456789ABC}</ProjectGuid>
    <OutputType>WinExe</OutputType>
    <RootNamespace>WSLFramework</RootNamespace>
    <AssemblyName>旺商聊框架</AssemblyName>
    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
    <Deterministic>true</Deterministic>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <PlatformTarget>x86</PlatformTarget>
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <LangVersion>7.3</LangVersion>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <PlatformTarget>x86</PlatformTarget>
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
    <LangVersion>7.3</LangVersion>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="System" />
    <Reference Include="System.Core" />
    <Reference Include="System.Drawing" />
    <Reference Include="System.Windows.Forms" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Web.Extensions" />
    <Reference Include="System.Security" />
    <Reference Include="Microsoft.CSharp" />
    <!-- HPSocket.Net 高性能网络通信框架 -->
    <Reference Include="HPSocket.Net">
      <HintPath>..\WangShangLiaoBot\packages\HPSocket.Net.6.0.7.1\lib\net40\HPSocket.Net.dll</HintPath>
    </Reference>
  </ItemGroup>
  <ItemGroup>
    <!-- 入口 -->
    <Compile Include="Program.cs" />
    <Compile Include="MainForm.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="MainForm.Designer.cs">
      <DependentUpon>MainForm.cs</DependentUpon>
    </Compile>
    
    <!-- 窗体 -->
    <Compile Include="Forms\LoginDialog.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="Forms\TrusteeForm.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="Forms\ScoreForm.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="Forms\AddAccountForm.cs">
      <SubType>Form</SubType>
    </Compile>
    
    <!-- 协议 -->
    <Compile Include="Protocol\ZCGProtocol.cs" />
    <Compile Include="Protocol\ZCGApiHandler.cs" />
    <Compile Include="Protocol\ZCGFullApiSpec.cs" />
    <Compile Include="Protocol\NimMessageProcessor.cs" />
    <Compile Include="Protocol\ZCGMessageFormat.cs" />
    
    <!-- 模型 -->
    <Compile Include="Models\FrameworkMessage.cs" />
    <Compile Include="Models\BotAccount.cs" />
    
    <!-- 原生API封装 -->
    <Compile Include="Native\NimApi.cs" />
    
    <!-- 工具 -->
    <Compile Include="Utils\Logger.cs" />
    
    <!-- ===== Services/Core - 核心服务 ===== -->
    <Compile Include="Services\Core\AccountingService.cs" />
    <Compile Include="Services\Core\BotConfigSyncService.cs" />
    <Compile Include="Services\Core\BotLoginService.cs" />
    <Compile Include="Services\Core\BotService.cs" />
    <Compile Include="Services\Core\FrameworkServer.cs" />
    <Compile Include="Services\Core\FrameworkServer.ApiExecute.cs" />
    <Compile Include="Services\Core\FrameworkServer.Cdp.cs" />
    <Compile Include="Services\Core\FrameworkServer.ConfigSync.cs" />
    <Compile Include="Services\Core\FrameworkServer.DataProcessing.cs" />
    <Compile Include="Services\Core\FrameworkServer.Dispose.cs" />
    <Compile Include="Services\Core\FrameworkServer.Helpers.cs" />
    <Compile Include="Services\Core\FrameworkServer.HPSocket.cs" />
    <Compile Include="Services\Core\FrameworkServer.Lottery.cs" />
    <Compile Include="Services\Core\FrameworkServer.MessageHandlers.cs" />
    <Compile Include="Services\Core\FrameworkServer.Sending.cs" />
    <Compile Include="Services\Core\FrameworkServer.ServerControl.cs" />
    
    <!-- ===== Services/Domain - 业务域服务 ===== -->
    <Compile Include="Services\Domain\FriendManagementService.cs" />
    <Compile Include="Services\Domain\GroupManagementService.cs" />
    <Compile Include="Services\Domain\GroupMemberService.cs" />
    <Compile Include="Services\Domain\IDQueryService.cs" />
    <Compile Include="Services\Domain\NewMemberService.cs" />
    <Compile Include="Services\Domain\PlayerService.cs" />
    
    <!-- ===== Services/EventDriven - 事件驱动模块 ===== -->
    <Compile Include="Services\EventDriven\Examples.cs" />
    <Compile Include="Services\EventDriven\WSLBotContext.cs" />
    <Compile Include="Services\EventDriven\WSLBotFactory.cs" />
    <Compile Include="Services\EventDriven\WSLEventInvoker.cs" />
    <Compile Include="Services\EventDriven\WSLEvents.cs" />
    <Compile Include="Services\EventDriven\WSLMessageSender.cs" />
    <Compile Include="Services\EventDriven\Network\WSLClientListener.cs" />
    <Compile Include="Services\EventDriven\Network\WSLConnectionManager.cs" />
    <Compile Include="Services\EventDriven\Network\WSLPacketListener.cs" />
    
    <!-- ===== Services/Finance - 财务服务 ===== -->
    <Compile Include="Services\Finance\ScoreService.cs" />
    
    <!-- ===== Services - 基础服务 ===== -->
    <Compile Include="Services\CDPService.cs" />
    <Compile Include="Services\WslFieldMapper.cs" />
    
    <!-- ===== Services/Integration - 集成服务 ===== -->
    <Compile Include="Services\Integration\CDPBridge.cs" />
    <Compile Include="Services\Integration\WangShangLiaoApiClient.cs" />
    <Compile Include="Services\Integration\WangShangLiaoHttpApi.cs" />
    <Compile Include="Services\Integration\WangShangLiaoLocalStorage.cs" />
    <Compile Include="Services\Integration\XPluginApiHandler.cs" />
    <Compile Include="Services\Integration\XPluginClient.cs" />
    <Compile Include="Services\Integration\XPluginService.cs" />
    <Compile Include="Services\Integration\YXClientService.cs" />
    
    <!-- ===== Services/Lottery - 开奖服务 ===== -->
    <Compile Include="Services\Lottery\LotteryService.cs" />
    <Compile Include="Services\Lottery\SettlementService.cs" />
    
    <!-- ===== Services/Messaging - 消息服务 ===== -->
    <Compile Include="Services\Messaging\AutoReplyService.cs" />
    <Compile Include="Services\Messaging\BetParserService.cs" />
    <Compile Include="Services\Messaging\MessageEncryption.cs" />
    <Compile Include="Services\Messaging\MessageParser.cs" />
    <Compile Include="Services\Messaging\NimDirectClient.cs" />
    <Compile Include="Services\Messaging\NIMMessageParser.cs" />
    <Compile Include="Services\Messaging\NimService.cs" />
    <Compile Include="Services\Messaging\ProtobufBuilder.cs" />
    <Compile Include="Services\Messaging\ZCGMessageDelivery.cs" />
    <Compile Include="Services\Messaging\ZCGResponseFormatter.cs" />
    
    <!-- ===== Services/Scheduling - 调度服务 ===== -->
    <Compile Include="Services\Scheduling\HeartbeatService.cs" />
    <Compile Include="Services\Scheduling\PeriodManager.cs" />
    <Compile Include="Services\Scheduling\TimedMessageService.cs" />
    
    <!-- ===== Services/Security - 安全服务 ===== -->
    <Compile Include="Services\Security\SecureConfigService.cs" />
    <Compile Include="Services\Security\WslCrypto.cs" />
    
    <!-- ===== Services/Settings - 设置服务 ===== -->
    <Compile Include="Services\Settings\ConfigService.cs" />
    
    <!-- ===== Services/Storage - 存储服务 ===== -->
    <Compile Include="Services\Storage\ZCGDataStorage.cs" />
    
    <!-- ===== Services/GameService ===== -->
    <Compile Include="Services\GameService.cs" />
  </ItemGroup>
  <ItemGroup>
    <None Include="app.config" />
  </ItemGroup>
  
  <!-- ===== 构建后自动创建生产目录 (ZCG风格) ===== -->
  <Target Name="CreateProductionDirs" AfterTargets="Build">
    <MakeDir Directories="$(TargetDir)plugin" Condition="!Exists('$(TargetDir)plugin')" />
    <MakeDir Directories="$(TargetDir)YX_Clinent" Condition="!Exists('$(TargetDir)YX_Clinent')" />
    <MakeDir Directories="$(TargetDir)zcg" Condition="!Exists('$(TargetDir)zcg')" />
    <MakeDir Directories="$(TargetDir)zcg服务端收发日志" Condition="!Exists('$(TargetDir)zcg服务端收发日志')" />
    <MakeDir Directories="$(TargetDir)zcg收发日志" Condition="!Exists('$(TargetDir)zcg收发日志')" />
    <MakeDir Directories="$(TargetDir)旺旺号资料" Condition="!Exists('$(TargetDir)旺旺号资料')" />
    <MakeDir Directories="$(TargetDir)logs" Condition="!Exists('$(TargetDir)logs')" />
  </Target>
  
  <!-- ===== 构建后自动复制 HPSocket 原生 DLL ===== -->
  <Target Name="CopyHPSocketNativeDll" AfterTargets="Build">
    <PropertyGroup>
      <HPSocketNativeDll>..\WangShangLiaoBot\packages\HPSocket.Net.6.0.7.1\runtimes\win-x86\native\HPSocket4C.dll</HPSocketNativeDll>
    </PropertyGroup>
    <Copy SourceFiles="$(HPSocketNativeDll)" DestinationFolder="$(TargetDir)" 
          Condition="Exists('$(HPSocketNativeDll)') And !Exists('$(TargetDir)HPSocket4C.dll')" 
          SkipUnchangedFiles="true" />
    <Message Text="已复制 HPSocket4C.dll 到 $(TargetDir)" Importance="high" 
             Condition="Exists('$(HPSocketNativeDll)')" />
  </Target>
  
  <!-- 添加ZCGConfigService -->
  <ItemGroup>
    <Compile Include="Services\Storage\ZCGConfigService.cs" />
  </ItemGroup>
  
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
</Project>
