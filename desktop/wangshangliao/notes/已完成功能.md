# 旺商聊机器人 - 已完成功能文档

> 更新日期：2025-12-19
> 版本：v4.29

---

## 一、核心连接功能

### 1.1 自动连接旺商聊
- **功能描述**：通过 Chrome DevTools Protocol (CDP) 连接旺商聊客户端
- **实现方式**：WebSocket 连接到调试端口 9222
- **状态**：✅ 已完成

### 1.2 自动检测安装路径
- **功能描述**：自动扫描并检测旺商聊的安装路径
- **检测策略**：
  1. 从正在运行的进程获取路径
  2. 从注册表读取安装路径
  3. 扫描常见安装目录（C:\旺商聊、C:\Program Files 等）
  4. 全盘扫描（如果以上方法失败）
  5. 手动选择（最终备选方案）
- **状态**：✅ 已完成

### 1.3 自动启动调试模式
- **功能描述**：自动以调试模式启动旺商聊（带 `--remote-debugging-port=9222` 参数）
- **状态**：✅ 已完成

---

## 二、联系人管理功能

### 2.1 获取联系人列表
- **功能描述**：从旺商聊获取所有联系人/会话列表
- **获取信息**：
  - 昵称
  - 旺商号（账户ID）
  - 类型（会话/联系人）
  - 最后消息时间
- **状态**：✅ 已完成

### 2.2 联系人列表窗口
- **功能描述**：以 ListView 形式展示联系人
- **显示列**：昵称、旺商号、类型、最后消息
- **状态**：✅ 已完成

### 2.3 获取群成员
- **功能描述**：获取指定群聊的成员列表
- **操作方式**：选中群聊后点击"获取群成员"按钮
- **状态**：✅ 已完成

### 2.4 设为绑定群
- **功能描述**：将选中的群设为绑定群，用于自动回复等功能
- **保存内容**：群号、群名称
- **状态**：✅ 已完成

---

## 三、消息功能

### 3.1 发送消息
- **功能描述**：向指定联系人/群发送消息
- **实现方式**：通过 JavaScript 注入操作 DOM
- **状态**：✅ 已完成

### 3.2 自动回复
- **功能描述**：收到新消息后自动回复
- **可配置项**：
  - 启用/禁用自动回复
  - 自动回复内容
- **状态**：✅ 已完成（基础功能）

---

## 四、配置管理

### 4.1 我的旺商号设置
- **功能描述**：配置自己的旺商号（账户ID）
- **配置位置**：联系人列表窗口顶部
- **状态**：✅ 已完成

### 4.2 基本设置
- **已实现配置项**：
  - 我的旺商号 (`MyWangShangId`)
  - 管理旺旺号 (`AdminWangWangId`)
  - 绑定群号 (`GroupId`)
  - 绑定群名称 (`GroupName`)
  - 旺商聊安装路径 (`WangShangLiaoPath`)
  - CDP调试端口 (`DebugPort`)
- **状态**：✅ 已完成

### 4.3 配置持久化
- **功能描述**：配置保存到 XML 文件，程序重启后自动加载
- **配置文件**：`config.xml`
- **状态**：✅ 已完成

---

## 五、用户界面

### 5.1 登录窗口
- **功能描述**：程序启动时的登录界面
- **包含标签页**：登录、注册、续费、修改密码
- **状态**：✅ 已完成（UI框架）

### 5.2 主窗口
- **功能描述**：主操作界面
- **顶部工具栏**：
  - 连接状态显示
  - 启动旺商聊按钮
  - 连接/断开按钮
  - 上下分窗口按钮
  - 获取联系人按钮
- **标签页**：
  - 控制台
  - 基本设置
  - 自动回复
  - 日志
- **状态**：✅ 已完成

### 5.3 上下分处理窗口
- **功能描述**：积分管理界面
- **包含标签页**：上分/下分、设置、设置2、提示文本
- **状态**：✅ 已完成（UI框架）

### 5.4 联系人列表窗口
- **功能描述**：展示联系人的弹出窗口
- **功能按钮**：设为绑定群、获取群成员、关闭
- **状态**：✅ 已完成

---

## 六、日志功能

### 6.1 运行日志
- **功能描述**：记录程序运行状态和操作日志
- **显示位置**：主窗口"日志"标签页
- **状态**：✅ 已完成

### 6.2 调试信息
- **功能描述**：详细的调试日志输出
- **用途**：排查连接问题、脚本执行问题
- **状态**：✅ 已完成

---

## 七、技术实现

### 7.1 核心技术栈
| 技术 | 用途 |
|------|------|
| C# WinForms | 用户界面 |
| Chrome DevTools Protocol | 与旺商聊通信 |
| WebSocket | CDP 连接 |
| JavaScript 注入 | DOM 操作 |
| XML 序列化 | 配置存储 |

### 7.2 项目结构
```
src/WangShangLiaoBot/
├── Forms/           # 窗体文件
│   ├── LoginForm    # 登录窗口
│   ├── MainForm     # 主窗口
│   └── ScoreForm    # 上下分窗口
├── Models/          # 数据模型
│   ├── AppConfig    # 应用配置
│   ├── ContactInfo  # 联系人信息
│   ├── ChatMessage  # 聊天消息
│   └── Player       # 玩家/积分
├── Services/        # 服务类
│   ├── ChatService  # 聊天服务（CDP连接）
│   ├── ConfigService # 配置服务
│   └── AutoReplyService # 自动回复服务
└── Utils/           # 工具类
    └── Logger       # 日志工具
```

---

## 八、待完成功能

以下功能已有UI框架，待完善业务逻辑：

- [ ] 关键词自动回复（根据关键词回复不同内容）
- [ ] 批量群发消息
- [ ] 上下分处理完整逻辑
- [ ] 黑名单管理
- [ ] 消息监听（实时接收新消息）
- [ ] 提示音播放
- [ ] 用户注册/登录验证
- [ ] 导入/导出数据

---

## 九、使用说明

### 9.1 快速开始
1. 启动程序，登录（当前可直接点击登录）
2. 点击"连接框架"按钮
3. 程序会自动检测旺商聊路径并连接
4. 连接成功后，点击"获取联系人"查看联系人列表

### 9.2 设置旺商号
1. 点击"获取联系人"打开联系人窗口
2. 在顶部"我的旺商号"输入框填入您的账号
3. 点击"保存"按钮

### 9.3 绑定群
1. 在联系人列表中选中目标群
2. 点击"设为绑定群"按钮
3. 保存成功后用于自动回复等功能

---

*文档结束*

